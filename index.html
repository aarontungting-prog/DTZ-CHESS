<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>霓虹西洋棋：DTZ 最終版</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="style.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.128.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.128.0/examples/jsm/"
        }
    }
    </script>
</head>
<body>

<div id="loading">系統初始化中...</div>

<div id="auth-modal">
    <div class="auth-box">
        <h2>DTZ CHESS</h2>
        <div id="auth-error" style="color:#ff0055; font-size:12px; margin-bottom:10px;"></div>
        
        <div id="email-login-form">
            <input type="email" id="email" class="auth-input" placeholder="電子信箱">
            <input type="password" id="password" class="auth-input" placeholder="密碼">
            <div id="nickname-container">
                <input type="text" id="nickname" class="auth-input" placeholder="設定您的暱稱">
            </div>
            <button id="auth-action-btn" class="auth-btn">進入世界</button>
            <div class="forgot-link" id="forgot-pw">忘記密碼？</div>
        </div>
        
        <button id="guest-btn" class="guest-btn">訪客登入</button>
    </div>
</div>

<div id="ui" style="display:none;">
    
    <div id="mobile-menu-btn">☰ 選單</div>

    <div id="menu-panel" class="hud-container">
        <div class="hud-box profile-box">
            <div class="user-card-header">
                <img id="hud-avatar" src="" class="mini-avatar">
                <div class="user-info">
                    <span id="user-name" class="name-text">Player</span>
                    <span id="user-rank" class="rank-badge rank-bronze">銅牌</span>
                </div>
            </div>
            <div class="elo-text">
                戰力積分 (ELO): <span id="user-elo">0</span>
            </div>
            <button id="btn-custom" class="custom-btn">🛠️ 個人化設定</button>
        </div>

        <div class="hud-box action-box">
            <div class="lobby-title">遊戲模式</div>
            <div style="display:flex; gap:5px; margin-bottom:10px;">
                <button id="mode-2p" class="mode-btn active">1v1 經典</button>
                <button id="mode-4p" class="mode-btn">4人 混戰</button>
            </div>

            <div class="lobby-title">對戰大廳</div>
            <div id="room-display" class="room-status">狀態：閒置中</div>
            
            <div id="lobby-buttons">
                <button id="btn-create" class="game-btn">創建房間 (執白)</button>
                <button id="btn-join" class="game-btn join-btn">加入房間 (執黑)</button>
            </div>

            <button id="btn-leave" class="game-btn" style="display:none; background:#0088ff; color:white; margin-top:10px;">退出房間 / 結束連線</button>
            
            <div class="separator"></div>
            <button id="btn-logout" class="logout-btn">登出</button>
        </div>
    </div>

    <div id="status-panel" class="hud">
        <h1>NEON CHESS</h1>
        <div id="turn-txt">等待對戰</div>
        <div id="opponent-info" style="font-size: 12px; color: #aaa; margin-top:5px;">對手: ---</div>
    </div>
    <div id="footer-watermark">Made by DTZ</div>
</div>

<div id="menu-backdrop"></div>
<div id="custom-panel" class="side-panel">
    <h2>個人化設定</h2>
    <div class="custom-section">
        <h3>👤 指揮官識別證</h3>
        <div class="avatar-preview-container" id="avatar-container">
            <img id="my-avatar" src="" alt="Avatar" class="avatar-img">
            <div id="my-frame" class="avatar-frame"></div>
            <input type="file" id="avatar-upload" accept="image/*" style="display: none;">
            <div id="avatar-hint">更換圖片</div>
        </div>
        <div id="guest-avatar-controls">
            <div style="display:flex; gap:5px; margin-bottom: 10px;">
                <input type="text" id="avatar-seed" class="custom-input" placeholder="輸入代碼" style="margin:0;">
                <button id="btn-random-avatar" class="small-btn">🎲 隨機</button>
            </div>
        </div>
        <label>顯示暱稱:</label>
        <input type="text" id="edit-name" class="custom-input">
    </div>

    <div class="custom-section">
        <h3>♟️ 棋子模型</h3>
        <div class="skin-grid" id="piece-skin-grid">
            <div class="skin-item selected" data-val="neon"><div class="skin-icon">💠</div><div class="skin-name">電馭霓虹</div></div>
            <div class="skin-item" data-val="classic"><div class="skin-icon">♟️</div><div class="skin-name">經典實體</div></div>
            <div class="skin-item locked"><div class="skin-icon">🔒</div><div class="skin-name">敬請期待</div></div>
        </div>
        <input type="hidden" id="selected-piece-style" value="neon">
    </div>

    <div class="custom-section">
        <h3>🔲 戰場材質</h3>
        <div class="skin-grid" id="board-skin-grid">
            <div class="skin-item selected" data-val="neon"><div class="skin-icon">🌌</div><div class="skin-name">全息投影</div></div>
            <div class="skin-item locked"><div class="skin-icon">🔒</div><div class="skin-name">敬請期待</div></div>
        </div>
        <input type="hidden" id="selected-board-style" value="neon">
    </div>
    
    <button id="btn-save-custom" class="game-btn save-btn">保存並套用</button>
    <button id="btn-close-custom" class="game-btn" style="background:#333; margin-top:10px;">關閉面板</button>
</div>

<script type="module">
    import { initGame } from './game_logic.js';
    window.onload = () => { 
        console.log("System Start.");
        initGame(); 
    };
</script>
</body>
</html>
