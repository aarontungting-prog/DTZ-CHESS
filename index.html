<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>霓虹西洋棋：安心睡眠版</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: sans-serif; }
        #info {
            position: absolute; top: 10px; left: 10px; color: #00e5ff;
            background: rgba(0,0,0,0.8); padding: 15px; border-radius: 8px;
            pointer-events: none; border: 1px solid #00e5ff;
        }
        h1 { margin: 0 0 10px 0; font-size: 18px; }
        p { margin: 5px 0; font-size: 14px; color: #ccc; }
        button {
            pointer-events: auto; padding: 8px 15px; background: #333; 
            color: white; border: 1px solid #555; cursor: pointer; margin-top: 10px;
        }
        button:hover { background: #00e5ff; color: black; }
    </style>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>

<div id="info">
    <h1>霓虹四人棋 (展示模式)</h1>
    <p>狀態：離線運作中 ✅</p>
    <p>說明：這是一個純視覺演示，證明架構可行。</p>
    <p>操作：滑鼠左鍵旋轉，右鍵平移，滾輪縮放。</p>
    <div style="pointer-events: auto;">
        <button onclick="window.switchMode(false)">切換 2人</button>
        <button onclick="window.switchMode(true)">切換 4人</button>
    </div>
</div>

<script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

    // --- 變數 ---
    let scene, camera, renderer, controls;
    let tiles = [];
    let pieces = [];

    // --- 材質 ---
    const MAT = {
        base: new THREE.MeshStandardMaterial({color: 0x111111, roughness: 0.5}),
        tileW: new THREE.MeshStandardMaterial({color: 0xeeeeee, roughness: 0.2}),
        tileB: new THREE.MeshStandardMaterial({color: 0x333333, roughness: 0.2}),
        // 霓虹風
        neonW: new THREE.MeshStandardMaterial({color: 0x00ffff, emissive: 0x004444}),
        neonB: new THREE.MeshStandardMaterial({color: 0x111111, roughness: 0.1}),
        // 棋子顏色
        red: new THREE.MeshStandardMaterial({color: 0xff3333, emissive:0xaa0000, emissiveIntensity:0.2}),
        blue: new THREE.MeshStandardMaterial({color: 0x3333ff, emissive:0x0000aa, emissiveIntensity:0.2}),
        yellow: new THREE.MeshStandardMaterial({color: 0xffff00, emissive:0xaaaa00, emissiveIntensity:0.2}),
        green: new THREE.MeshStandardMaterial({color: 0x00ff00, emissive:0x00aa00, emissiveIntensity:0.2}),
        white: new THREE.MeshStandardMaterial({color: 0xffffff}),
        black: new THREE.MeshStandardMaterial({color: 0x222222})
    };

    // --- 初始化 ---
    function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0a0a10); // 深邃夜空
        scene.fog = new THREE.FogExp2(0x0a0a10, 0.02);

        camera = new THREE.PerspectiveCamera(50, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.set(0, 20, 15);

        renderer = new THREE.WebGLRenderer({antialias: true});
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 0.5;

        // 燈光
        const ambient = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambient);
        const dirLight = new THREE.DirectionalLight(0xffffff, 1.5);
        dirLight.position.set(10, 20, 10);
        scene.add(dirLight);

        // 預設 4人棋
        create4PBoard();

        window.addEventListener('resize', onResize);
        animate();
    }

    function onResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function clearScene() {
        tiles.forEach(t => scene.remove(t));
        pieces.forEach(p => scene.remove(p));
        tiles = []; pieces = [];
    }

    // --- 建立 2人棋盤 ---
    function create2PBoard() {
        clearScene();
        // 底板
        const base = new THREE.Mesh(new THREE.BoxGeometry(9, 0.5, 9), MAT.base);
        base.position.y = -0.25;
        scene.add(base); tiles.push(base);

        for(let r=0; r<8; r++) {
            for(let c=0; c<8; c++) {
                const isWhite = (r+c)%2 === 0;
                const tile = new THREE.Mesh(
                    new THREE.BoxGeometry(1, 0.2, 1), 
                    isWhite ? MAT.neonW : MAT.neonB
                );
                tile.position.set(c-3.5, 0, r-3.5);
                scene.add(tile); tiles.push(tile);

                // 簡單擺子
                if(r < 2) createPiece(c-3.5, r-3.5, MAT.white);
                if(r > 5) createPiece(c-3.5, r-3.5, MAT.black);
            }
        }
        camera.position.set(0, 15, 12);
    }

    // --- 建立 4人棋盤 ---
    function create4PBoard() {
        clearScene();
        // 底板
        const base = new THREE.Mesh(new THREE.BoxGeometry(15, 0.5, 15), MAT.base);
        base.position.y = -0.25;
        scene.add(base); tiles.push(base);

        const size = 14;
        const offset = 6.5;

        for(let r=0; r<size; r++) {
            for(let c=0; c<size; c++) {
                // 挖空角落 (3x3)
                if((r<3 || r>10) && (c<3 || c>10)) continue;

                const isWhite = (r+c)%2 === 0;
                const tile = new THREE.Mesh(
                    new THREE.BoxGeometry(1, 0.2, 1), 
                    isWhite ? MAT.neonW : MAT.neonB
                );
                tile.position.set(c-offset, 0, offset-r);
                scene.add(tile); tiles.push(tile);

                // 擺放棋子 (示意)
                if(r === 1) createPiece(c-offset, offset-r, MAT.blue);  // 上 (藍)
                if(r === 12) createPiece(c-offset, offset-r, MAT.green); // 下 (綠)
                if(c === 1) createPiece(c-offset, offset-r, MAT.yellow); // 左 (黃)
                if(c === 12) createPiece(c-offset, offset-r, MAT.red);   // 右 (紅)
            }
        }
        camera.position.set(0, 25, 20);
    }

    function createPiece(x, z, mat) {
        const geo = new THREE.CylinderGeometry(0.3, 0.3, 1, 16);
        const piece = new THREE.Mesh(geo, mat);
        piece.position.set(x, 0.6, z);
        scene.add(piece);
        pieces.push(piece);
    }

    function animate() {
        requestAnimationFrame(animate);
        controls.update();
        renderer.render(scene, camera);
    }

    // 暴露給 HTML 按鈕
    window.switchMode = (is4P) => {
        if(is4P) create4PBoard();
        else create2PBoard();
    };

    // 啟動
    init();

</script>
</body>
</html>
